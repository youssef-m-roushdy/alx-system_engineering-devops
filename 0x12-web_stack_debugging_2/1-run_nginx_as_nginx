#!/bin/bash

# Stop Nginx service
service nginx stop

# Backup original nginx.conf
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# Replace user directive in nginx.conf with nginx
sed -i 's/user\s*nginx;/user nginx;/' /etc/nginx/nginx.conf

# Find all active IPs
active_ips=$(ip -o -4 addr show scope global | awk '{gsub(/\/[0-9]*/, ""); print $4}')

# Generate configuration for listening on all active IPs
echo "server {
    listen 8080;
    $(for ip in $active_ips; do echo "listen $ip:8080;"; done)
    server_name _;
    location / {
        # Your configuration directives here
    }
}" > /etc/nginx/sites-available/default

# Start Nginx service
service nginx start

echo "Nginx configured to run as nginx user and listen on all active IPs on port 8080."
